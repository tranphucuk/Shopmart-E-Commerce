var revenue={init:function(){this.registerEvents();this.initDatePicker()},registerEvents:function(){$("#reportrange").on("cancel.daterangepicker",function(){$("#reportrange span").html(moment().subtract(29,"days").format("MMMM D, YYYY")+" - "+moment().format("MMMM D, YYYY"))});$('#toggleController input[type="checkbox"]').on("click",function(){revenue.doToggling()});$("#ddlShowPage").on("change",function(){common.config.pageSize=$("#ddlShowPage :selected").text();common.config.pageIndex=1;$("#pagination-revenue").twbsPagination("destroy");revenue.getDataForPaging()});$("#sort-order").on("change",function(){revenue.configPagination();revenue.getDataForPaging()})},initDatePicker:function(){function i(n,t){$("#reportrange span").html(n.format("MMMM D, YYYY")+" - "+t.format("MMMM D, YYYY"));revenue.bindData(common.formatDateTime(n._d),common.formatDateTime(t._d))}var n=moment().subtract(30,"days"),t=moment();$("#reportrange").daterangepicker({startDate:n,endDate:t,opens:"left",autoUpdateInput:!1,locale:{cancelLabel:"Clear"},ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Last 3 Months":[moment().subtract(3,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Last 6 Months":[moment().subtract(6,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}},i);i(n,t)},bindData:function(n,t){$.ajax({type:"GET",url:"/Admin/Revenues/GetRevenue",data:{fromDate:n,toDate:t},success:function(n){revenue.dataCollection=[];revenue.revenue=[];revenue.profit=[];revenue.funds=[];revenue.session=[];$.each(n.Finance,function(n,t){revenue.revenue.push([new Date(t.Date).getTime(),t.Revenue]);revenue.profit.push([new Date(t.Date).getTime(),t.Profit]);revenue.funds.push([new Date(t.Date).getTime(),t.Funds])});$.each(n.Session,function(n,t){revenue.session.push(t.TotalSession)});revenue.configPagination();revenue.getDataForPaging();revenue.revenue.length>0&&(revenue.dataCollection.push(revenue.revenue,revenue.profit,revenue.funds),$("#toggleController").find("input[type='checkbox']:checked").length==0?($("#toggleController").find("input[type='checkbox']").click(),revenue.doToggling(),revenue.doSparklineTotalSession(revenue.session),revenue.doSparklineTotalRevenue(revenue.revenue)):(revenue.doToggling(),revenue.doSparklineTotalSession(revenue.session),revenue.doSparklineTotalRevenue(revenue.revenue)))}})},getDataForPaging:function(){var n="",i=$("#tbl-revenue-template").html(),t=$("#reportrange span").html().split("-"),r=t[0],u=t[1];$.ajax({type:"GET",url:"/Admin/Revenues/RevenueReportPaging",data:{fromDate:r,toDate:u,page:common.config.pageIndex,pageSize:common.config.pageSize,sortOrder:$("#sort-order").val()},dataType:"json",success:function(t){$.each(t.Results,function(t,r){var u={};u.Date=common.formatDate(r.Date);u.Sesion=r.TotalSession;u.Revenue=common.formartNumber(r.Revenue);u.Funds=common.formartNumber(r.Funds);u.Profit=common.formartNumber(r.Profit);u.Flat=r.FlatPercent.toFixed(2);n+=Mustache.render(i,u)});$("#tbl-revenue-content").html(n);$("#lbl-total-report").html(t.RowCount);t.RowCount>0&&revenue.pagination(t.RowCount)}})},pagination:function(n){var t=Math.ceil(n/common.config.pageSize);$("#pagination-revenue").twbsPagination({totalPages:t,visiblePages:5,onPageClick:function(n,t){t!=common.config.pageIndex&&(common.config.pageIndex=t,revenue.getDataForPaging())}})},configPagination:function(){$("#pagination-revenue").twbsPagination("destroy");$("#ddlShowPage").prop("selectedIndex",0);common.config.pageSize=10;common.config.pageIndex=1},calculateDay:function(){var n=$("#reportrange span").html(),t=new Date(n.split("-")[0]),i=new Date(n.split("-")[1]);return Math.ceil(parseInt(i-t)/864e5)},doToggling:function(){function u(n,t,i){$('<div id="tooltip">'+i+"<\/div>").css({position:"absolute",display:"none",top:t+5,left:n+20,border:"2px solid #4572A7",padding:"2px",size:"10","background-color":"#fff",opacity:.8}).appendTo("body").fadeIn(200)}revenue.dataSet=[];$.each($('#toggleController input[type="checkbox"]'),function(n,t){var r=$(t).is(":checked"),i;r&&(i=parseInt($(t).attr("data-id")),revenue.dataSet.push({label:revenue.labelCollection[i],data:revenue.dataCollection[i],color:revenue.lineChartColorCollection[i]}))});var n=revenue.calculateDay(),t=n>=89?[1,"month"]:[4,"day"],i=n>=89?"%b/%y":"%d/%m",r={series:{lines:{show:!0,fill:!0,lineWidth:1},points:{radius:3,fill:!0,show:!0}},colors:["#3F97EB","#72c380","#f7cb38"],xaxis:{mode:"time",tickSize:t,timeformat:i,axisLabelUseCanvas:!0,axisLabelFontSizePixels:12,axisLabelFontFamily:"Verdana, Arial",axisLabelPadding:10},yaxes:[{}],grid:{borderWidth:0,borderHeight:0,hoverable:!0,clickable:!0,backgroundColor:{colors:["#ffffff","#EDF5FF"]},autoHighlight:!0,mouseActiveRadius:30},legend:{position:"ne",margin:[0,-18],noColumns:0,labelFormatter:function(n){return n+"&nbsp;&nbsp;"},width:40,height:1}};$.fn.UseTooltip=function(){var n=null;$(this).bind("plothover",function(t,i,r){if(r){if(n!=r.dataIndex){n=r.dataIndex;$("#tooltip").remove();var f=r.datapoint[0],e=r.datapoint[1];u(r.pageX,r.pageY,new Date(f).toString("MMM/dd/yyyy")+"<br/><strong>$"+common.formartNumber(e,"0,0")+"<\/strong> ("+r.series.label+")")}}else $("#tooltip").remove(),n=null})};$.plot($("#chart_plot_02"),revenue.dataSet,r);$("#chart_plot_02").UseTooltip()},doSparklineTotalSession:function(n){$(".sparkline11").sparkline(n,{type:"bar",height:"40",barWidth:8,colorMap:{"7":"#a1a1a1"},barSpacing:2,barColor:"#26B99A"});var t=0;$.each(n,function(n,i){t+=i});$("#total-session").html(t)},doSparklineTotalRevenue:function(n){$(".sparkline22").sparkline(n,{type:"line",numberFormatter:function(n){return"$"+common.formartNumber(n,"0,0")},height:"40",width:"200",lineColor:"#26B99A",fillColor:"#ffffff",lineWidth:3,spotColor:"#34495E",minSpotColor:"#34495E"});var t=0;$.each(n,function(n,i){t+=i[1]});$("#total-revenue").html("$"+common.formartNumber(t,"0,0"))},labelCollection:["Revenue Report","Profit Report","Funds Report",],lineChartColorCollection:["#3F97EB","#72c380","#f7cb38"],dataCollection:[],dataSet:[],revenue:[],profit:[],funds:[],session:[]};revenue.init();