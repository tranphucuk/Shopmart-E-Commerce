var productCategory={init:function(){this.loadData();this.registerEvents()},registerEvents:function(){var n=$("#frmProductCategory").validate({errorClass:"red",rules:{categoryName:"required",categoryDescription:"required",categoryOrder:{required:!0,number:!0,min:1},categorySeoTitle:"required",categoryKeyword:"required"},messages:{categoryName:{required:"Category name is required"},categoryDescription:{required:"Category description is required"},categoryOrder:{required:"Order is required",number:"Order must be a number",min:"Order must be equal or greater than 1"},categorySeoTitle:{required:"Seo title is required"},categoryKeyword:{required:"Seo keyword is required"}},showErrors:function(t,i){if(n.submitted){var r="";$.each(i,function(){r+="* "+this.message+"\n"});common.notify(r,"warn");submitted=!1}}});$("#btnCreate").off("click").on("click",function(){$.when(productCategory.GetParent()).then(function(){$("#add_edit_modal").modal("show");$(".hideBorder").val("Create Category");productCategory.clearForm()})});$("body").on("click","#btnRemove",function(n){n.preventDefault();var t=$("#hidCategory").val();common.confirm("Are you sure to delete ?",function(){$.ajax({url:"/Admin/ProductCategory/Delete",type:"POST",data:{id:t},success:function(){common.notify("Removed category success.","success");productCategory.loadData()},error:function(n){common.notify("An error has occurred. Please check console","error");console.log(n);productCategory.loadData()}})})});$("body").on("click","#btnUpdate",function(n){n.preventDefault();var t=$("#hidCategory").val();$.ajax({url:"/Admin/ProductCategory/GetById",type:"GET",data:{id:t},dataType:"json",beforeSend:function(){common.runLoadingIndicator()},success:function(n){$.when(productCategory.GetParent(n.ParentId)).then(function(){$("#add_edit_modal").modal("show");$("#txtAlias").val(n.SeoAlias);$("#hidCategory").val(n.Id);$(".hideBorder").val("Update Category: "+n.Name);$("#txtName").val(n.Name);$("#txtDescription").val(n.Description);$("#txtOrder").val(n.SortOrder);$("#txtImg").val(n.Image);$("#txtSeoDescription").val(n.SeoDescription);$("#txtSeoKeyword").val(n.SeoKeywords);$("#txtSeoTitle").val(n.SeoPageTitle);$("#ckStatus").prop("checked",n.Status);$("#ckShowHome").prop("checked",n.HomeFlag);$("#frmCreatedDate").show();$("#frmModifiedDate").show();$("#txtModifiedDate").val(common.formatDateTime(n.ModifiedDate));$("#txtCreatedDate").val(common.formatDateTime(n.CreatedDate));common.stopLoadingIndicator()})},error:function(){common.notify("An error has occured","error");common.stopLoadingIndicator()}})});$("#btnSave").off("click").on("click",function(){if(n.form()){var t={};$("#hidCategory").val()!=""&&(t.Id=$("#hidCategory").val(),t.CreatedDate=$("#txtCreatedDate").val());t.Name=$("#txtName").val();t.ParentId=$("#ddlCategory").val();t.Description=$("#txtDescription").val();t.SortOrder=$("#txtOrder").val();t.Image=$("#txtImg").val();t.SeoDescription=$("#txtSeoDescription").val();t.SeoKeywords=$("#txtSeoKeyword").val();t.SeoPageTitle=$("#txtSeoTitle").val();t.HomeFlag=$("#ckShowHome").is(":checked")?1:0;t.Status=$("#ckStatus").is(":checked")?1:0;$.ajax({url:"/Admin/ProductCategory/SaveCategory",type:"POST",dataType:"json",data:{categoryVm:t},success:function(n){common.notify("Save success category: "+n.Name,"success");$("#add_edit_modal").modal("hide");productCategory.loadData()},error:function(n){common.notify("Error: "+n.Message,"error");productCategory.loadData()}})}});$("#btn-tree-switch").off("click").on("click",function(){productCategory.toggle=!productCategory.toggle;productCategory.toggle==!0?($("#treeProductCategory").tree("collapseAll"),$("#btn-tree-switch").text("Expand")):($("#treeProductCategory").tree("expandAll"),$("#btn-tree-switch").text("Collapse"))});$("#btnSelectImg").off("click").on("click",function(){$("#categoryImage").val("");$("#categoryImage").click()});$("#categoryImage").on("change",function(){var n=$(this)[0].files,t=new FormData;t.append(n.Filename,n[0]);$.ajax({type:"POST",url:"/Admin/ProductCategory/UploadCategoryImage",data:t,contentType:!1,processData:!1,success:function(t){common.notify("Uploaded success image: "+n[0].name,"success");$("#txtImg").val(t)},error:function(n){common.notify("Error: "+n,"error");console.log(n)}})})},toggle:!1,clearForm:function(){$("#txtName").val("");$("#txtAlias").val("");$("#txtDescription").val("");$("#txtOrder").val(1);$("#txtImg").val("");$("#txtSeoDescription").val("");$("#txtSeoKeyword").val("");$("#txtSeoTitle").val("");$("#ckStatus").prop("checked",!0);$("#ckShowHome").prop("checked",!1);$("#frmCreatedDate").hide();$("#frmModifiedDate").hide();$("#txtCreatedDate").val(common.formatDateTime(new Date))},GetParent:function(n){return $.ajax({type:"GET",url:"/Admin/ProductCategory/GetAll",dataType:"json",beforeSend:common.runLoadingIndicator(),success:function(t){var i=[],r;$.each(t,function(n,t){i.push({id:t.Id,text:t.Name,parentId:t.ParentId,sortOrder:t.SortOrder})});r=common.unflattern(i);$("#ddlCategory").combotree({data:r});n!=null&&$("#ddlCategory").combotree("setValue",n);common.stopLoadingIndicator()}})},loadData:function(){$.ajax({type:"GET",url:"/Admin/ProductCategory/GetAll",dataType:"json",beforeSend:common.runLoadingIndicator(),success:function(n){var t=[],i;$.each(n,function(n,i){t.push({id:i.Id,text:i.Name,parentId:i.ParentId,sortOrder:i.SortOrder})});i=common.unflattern(t);$("#treeProductCategory").tree({data:i,animate:!0,lines:!0,dnd:!0,onContextMenu:function(n,t){n.preventDefault();$("#tt").tree("select",t.target);$("#hidCategory").val(t.id);$("#contextMenu").menu("show",{left:n.pageX,top:n.pageY})},onDrop:function(n,t,i){var r=$(this).tree("getNode",n),u;i==="append"?(u=[],$.each(r.children,function(n,t){u.push({key:t.id,value:n})}),$.ajax({url:"/Admin/ProductCategory/UpdateParentId",type:"POST",data:{sourceId:t.id,targetId:r.id,items:u},dataType:"json",success:function(){productCategory.loadData()}})):(i==="top"||i==="bottom")&&$.ajax({url:"/Admin/ProductCategory/ReOrder",type:"POST",data:{point:i,sourceId:t.id,targetId:r.id},dataType:"json",success:function(){productCategory.loadData()}})},formatter:function(n){var t=n.text;return n.children&&(t+="&nbsp;<span style='color:blue'>("+n.children.length+")<\/span>"),t}});$("#treeProductCategory").tree("collapseAll");productCategory.toggle=!0;common.stopLoadingIndicator()}})}};productCategory.init();