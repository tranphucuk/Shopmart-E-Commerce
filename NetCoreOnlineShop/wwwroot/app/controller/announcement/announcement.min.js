var announcement={init:function(){this.loadData();this.registerEvents();this.loadCkEditor()},registerEvents:function(){var n=$("#frm-announ").validate({errorClass:"red",rules:{txtAnnounTitle:"required",txtAnnounContent:"required"},messages:{txtAnnounTitle:{required:"*Please enter title"},txtAnnounContent:{required:"*Please enter content"}},showErrors:function(t,i){if(n.submitted){var r="";$.each(i,function(){r+="* "+this.message+"\n"});common.notify(r,"warn");submitted=!1}}});$("#ddlShowPage").on("change",function(){common.config.pageSize=$("#ddlShowPage :selected").text();common.config.pageIndex=1;$("#pagination-announ").twbsPagination("destroy");announcement.loadData()});$("#txt-announ-keyword").on("keypress",function(n){n.which===13&&$("#btn-search-announ").click()});$("#btn-search-announ").off("click").on("click",function(){$("#pagination-announ").twbsPagination("destroy");$("#ddlShowPage").prop("selectedIndex",0);common.config.pageIndex=1;common.config.pageSize=10;announcement.loadData()});$("#btn-create-announ").off("click").on("click",function(){$("#add-announ-modal").modal("show");announcement.clearData()});$("#btn-save-announ").off("click").on("click",function(){if(n.form()){var i=$("#hid-announ-id").val(),t={};i!=undefined&&i!=""&&(t.Id=i,t.CreatedDate=$("#hid-announ-date").val());t.Title=$("#txt-announ-title").val();t.Content=CKEDITOR.instances["txt-announ-content"].getData();t.Status=$("#ck-announ-status").is(":checked")?1:0;$.ajax({type:"POST",url:"/Admin/Announcement/SaveAnnouncement",data:{announcementViewModel:t},beforeSend:common.runLoadingIndicator(),success:function(n){n==!0?(common.notify("Save announcement success","success"),common.stopLoadingIndicator(),$("#add-announ-modal").modal("hide"),announcement.loadData()):(common.notify("Save announcement failed","error"),common.stopLoadingIndicator())}})}});$("body").on("click",".btnUpdateAnnoun",function(){var n=$(this).attr("data-id");$("#hid-announ-id").val(n);$.ajax({type:"GET",url:"/Admin/Announcement/GetDetail",data:{announcementId:n},beforeSend:common.runLoadingIndicator(),success:function(n){$("#add-announ-modal").modal("show");$("#txt-announ-title").val(n.Title);CKEDITOR.instances["txt-announ-content"].setData(n.Content);$("#ck-announ-status").prop("checked",n.Status);$("#hid-announ-date").val(n.CreatedDate);common.stopLoadingIndicator()}})});$("body").on("click",".btnSendAnnoun",function(){var n=$(this).attr("data-id");common.confirm("<b>Are you sure to send this?<\/b><\/br><\/br>***This announcement will be sent to all users.",function(){$.ajax({type:"POST",url:"/Admin/Announcement/SendAnnouncement",data:{announId:n},beforeSend:common.runLoadingIndicator(),success:function(n){n==!0?(common.notify("Sent announcement succeeded","success"),common.stopLoadingIndicator()):(common.notify("This announcement is already sent to all users.","warn"),common.stopLoadingIndicator())}})})});$("body").on("click",".btnDeleteAnnoun",function(){var n=$(this).data("id");common.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Announcement/Delete",data:{id:n},success:function(n){n==!0?(common.notify("Remove announcement success","success"),common.config.pageIndex=1,$("#pagination-announ").twbsPagination("destroy"),announcement.loadData()):common.notify("Remove page failed","error")}})})})},loadData:function(){var n="",t=$("#tbl-announ-template").html();$.ajax({type:"GET",url:"/Admin/Announcement/GetAllPaging",data:{keyword:$("#txt-announ-keyword").val(),page:common.config.pageIndex,pageSize:common.config.pageSize},beforeSend:common.runLoadingIndicator(),success:function(i){$.each(i.Results,function(i,r){var u={};u.Id=r.Id;u.Title=r.Title;u.Status=common.getStatusLabel(r.Status);u.CreatedDate=common.formatDateTime(r.CreatedDate);u.Sender=r.Username;n+=Mustache.render(t,u)});$("#tbl-announ-content").html(n);$("#lbl-total-announ").html(i.RowCount);i.RowCount>0&&announcement.pagination(i.RowCount);common.stopLoadingIndicator()}})},loadCkEditor:function(){CKEDITOR.replace("txtAnnounContent",{language:"en",width:"715px",height:"310px"});$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(n){this.$element[0]===n.target||this.$element.has(n.target).length||$(n.target).closest(".cke_dialog, .cke").length||this.$element.trigger("focus")},this))}},clearData:function(){$("#hid-announ-id").val("");$("#txt-announ-title").val("");CKEDITOR.instances["txt-announ-content"].setData("");$("#hid-announ-date").val("")},pagination:function(n){var t=Math.ceil(n/common.config.pageSize);$("#pagination-announ").twbsPagination({totalPages:t,visiblePages:5,onPageClick:function(n,t){t!=common.config.pageIndex&&(common.config.pageIndex=t,announcement.loadData())}})}};announcement.init();