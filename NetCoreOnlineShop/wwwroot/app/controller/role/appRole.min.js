var appRole={init:function(){this.loadData();this.registerEvents()},registerEvents:function(){var n=$("#frmRole").validate({errorClass:"red",rules:{roleName:"required",roleDescription:"required"}});$("body").on("click","#btnCreate",function(){$("#add_edit_Role").modal("show");$(".hideBorder").val("Create New Role");appRole.clearForm();n.resetForm()});$("body").on("click",".btnUpdateRole",function(){var t=$(this).attr("data-id");$.ajax({type:"GET",url:"/Admin/Role/GetRoleById",dataType:"json",data:{id:t},success:function(t){n.resetForm();$("#add_edit_Role").modal("show");$(".hideBorder").val("Update Role: "+t.Name);$("#hidRoleId").val(t.Id);$("#txtRoleName").val(t.Name);$("#txtDescription").val(t.Description)},error:function(n){common.notify("Error getting role detail","error");console.log(n)}})});$("body").on("click",".btnDeleteRole",function(){var n=$(this).attr("data-id");common.confirm("Are you sure to delete ?",function(){$.ajax({type:"POST",url:"/Admin/Role/DeleteAsync",data:{id:n},dataType:"json",success:function(n){common.notify("Removed role: "+n.Message,"success");appRole.loadData()},error:function(n){common.notify(n,"error")}})})});$("#btnSave").off("click").on("click",function(t){if(t.preventDefault(),n=$("#frmRole").validate(),n.form()){var i={};$("#hidRoleId").val()!==""&&(i.Id=$("#hidRoleId").val());i.Name=$("#txtRoleName").val();i.Description=$("#txtDescription").val();$.ajax({type:"POST",url:"/Admin/Role/SaveRoleAsync",data:{appRoleVm:i},success:function(n){n.Message=="add"?common.notify("Created role: "+n.Data,"success"):n.Message=="update"&&common.notify("Update role: "+n.Data,"success");$("#add_edit_Role").modal("hide");appRole.loadData()},error:function(n){$("#add_edit_Role").modal("hide");appRole.loadData();common.notify(n.responseText,"error");console.log(n)}})}});$("#txtKeyword").off("keypress").on("keypress",function(n){n.which==13&&appRole.loadData()});$("#btnSearch").off("click").on("click",function(){appRole.loadData()});$("body").on("click",".btnGrantPermission",function(){var n=$(this).attr("data-id"),t;$("#hiddenRoleId").val(n);t=$.ajax(appRole.loadFunctions());t.done(function(){$.ajax({type:"GET",url:"/Admin/Role/LoadPermission",data:{roleId:n},dataType:"json",beforeSend:common.runLoadingIndicator(),success:function(n){$("#tblPermisson tbody tr").each(function(t,i){$.each(n,function(){$(i).attr("data-id")==this.FunctionId&&($(i).find(".ckView").prop("checked",this.CanRead),$(i).find(".ckCreate").prop("checked",this.CanCreate),$(i).find(".ckUpdate").prop("checked",this.CanUpdate),$(i).find(".ckDelete").prop("checked",this.CanDelete))});$(".ckView:checked").length==$("#tblPermisson tbody .ckView").length?$(".ckCheckAllView").prop("checked",!0):$(".ckCheckAllView").prop("checked",!1);$(".ckCreate:checked").length==$("#tblPermisson tbody .ckCreate").length?$(".ckCheckAllCreate").prop("checked",!0):$(".ckCheckAllCreate").prop("checked",!1);$(".ckUpdate:checked").length==$("#tblPermisson tbody .ckUpdate").length?$(".ckCheckAllUpdate").prop("checked",!0):$(".ckCheckAllUpdate").prop("checked",!1);$(".ckDelete:checked").length==$("#tblPermisson tbody .ckDelete").length?$(".ckCheckAllDelete").prop("checked",!0):$(".ckCheckAllDelete").prop("checked",!1)});$("#add_edit_Permission").modal("show");common.stopLoadingIndicator()},error:function(n){common.notify("Error: "+n,"error")}})})});$("#btnSavePermission").off("click").on("click",function(){var t=$("#hiddenRoleId").val(),n=[];$("#tblPermisson tbody tr").each(function(t,i){n.push({RoleId:$("#hiddenRoleId").val(),FunctionId:$(i).attr("data-id"),CanRead:$(i).find(".ckView").is(":checked"),CanCreate:$(i).find(".ckCreate").is(":checked"),CanUpdate:$(i).find(".ckUpdate").is(":checked"),CanDelete:$(i).find(".ckDelete").is(":checked")})});$.ajax({type:"POST",url:"/Admin/Role/SavePermission",data:{roleId:t,listPermissionVm:n},beforeSend:common.runLoadingIndicator(),success:function(n){n.Success==!1?(common.notify("Error: "+n.Message,"error"),common.stopLoadingIndicator()):($("#add_edit_Permission").modal("hide"),common.notify("Update Permission successfully","success"),common.stopLoadingIndicator())}})});$(".ckCheckAllView").off("change").on("change",function(){$(this).is(":checked")?$("#tblPermisson tbody tr").each(function(n,t){$(t).find(".ckView").prop("checked",!0)}):$("#tblPermisson tbody tr").each(function(n,t){$(t).find(".ckView").prop("checked",!1)})});$(".ckCheckAllCreate").off("change").on("change",function(){$(this).is(":checked")?$("#tblPermisson tbody tr").each(function(n,t){$(t).find(".ckCreate").prop("checked",!0)}):$("#tblPermisson tbody tr").each(function(n,t){$(t).find(".ckCreate").prop("checked",!1)})});$(".ckCheckAllUpdate").off("change").on("change",function(){$(this).is(":checked")?$("#tblPermisson tbody tr").each(function(n,t){$(t).find(".ckUpdate").prop("checked",!0)}):$("#tblPermisson tbody tr").each(function(n,t){$(t).find(".ckUpdate").prop("checked",!1)})});$(".ckCheckAllDelete").off("change").on("change",function(){$(this).is(":checked")?$("#tblPermisson tbody tr").each(function(n,t){$(t).find(".ckDelete").prop("checked",!0)}):$("#tblPermisson tbody tr").each(function(n,t){$(t).find(".ckDelete").prop("checked",!1)})});$("body").on("click",".ckView",function(){appRole.isReadAll()});$("body").on("click",".ckCreate",function(){appRole.isCreateAll()});$("body").on("click",".ckUpdate",function(){appRole.isEditAll()});$("body").on("click",".ckDelete",function(){appRole.isDeleteAll()})},loadData:function(){$.ajax({type:"GET",url:"/Admin/Role/GetAllPaging",data:{keyword:$("#txtKeyword").val(),pageSize:common.config.pageSize,page:common.config.pageIndex},success:function(n){var i=$("#table-template").html(),t="";$.each(n.Results,function(r,u){var f={};f.Id=u.Id;f.Name=u.Name;f.Description=u.Description;t+=Mustache.render(i,f);t!=null&&($("#tbl-content").html(t),$("#lblTotalRecords").text(n.Results.length))})},error:function(n){console.log(n);common.notify("An error has occurred","error")}})},loadFunctions:function(){$.ajax({type:"GET",url:"/Admin/Function/GetAll",success:function(n){$("#add_edit_Permission").modal("show");var t="",i=$("#list-function-template").html();$.each(n,function(n,r){t+=Mustache.render(i,{Id:r.Id,Tree:"treegrid-"+r.Id,Name:r.Name,TreeParent:r.ParentId==null?"":"treegrid-parent-"+r.ParentId})});t!=""&&$("#tbl-function-content").html(t);$(".tree").treegrid({initialState:"collapsed"})},error:function(n){common.notify("Error getting functions list/n"+n,"error")}})},clearForm:function(){$("#hidUserId").val("");$("#txtRoleName").val("");$("#txtDescription").val("")},isReadAll:function(){var n=$("#tbl-function-content .ckView").length;totalChecked=$("#tbl-function-content .ckView:checked").length;totalChecked<n?$(".ckCheckAllView").prop("checked",!1):$(".ckCheckAllView").prop("checked",!0)},isCreateAll:function(){var n=$("#tbl-function-content .ckCreate").length;totalChecked=$("#tbl-function-content .ckCreate:checked").length;totalChecked<n?$(".ckCheckAllCreate").prop("checked",!1):$(".ckCheckAllCreate").prop("checked",!0)},isEditAll:function(){var n=$("#tbl-function-content .ckUpdate").length;totalChecked=$("#tbl-function-content .ckUpdate:checked").length;totalChecked<n?$(".ckCheckAllUpdate").prop("checked",!1):$(".ckCheckAllUpdate").prop("checked",!0)},isDeleteAll:function(){var n=$("#tbl-function-content .ckDelete").length;totalChecked=$("#tbl-function-content .ckDelete:checked").length;totalChecked<n?$(".ckCheckAllDelete").prop("checked",!1):$(".ckCheckAllDelete").prop("checked",!0)},clearPermission:function(){$('.tbl-permission input[type="checkbox"]').prop("checked",!1)}};appRole.init();