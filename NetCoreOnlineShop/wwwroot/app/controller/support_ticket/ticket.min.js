var ticket={init:function(){this.loadData();this.registerEvents()},registerEvents:function(){$("#ddlShowPage").on("change",function(){common.config.pageSize=$("#ddlShowPage :selected").text();common.config.pageIndex=1;$("#pagination-ticket").twbsPagination("destroy");ticket.loadData()});$("#txt-ticket-keyword").on("keypress",function(n){n.which===13&&$("#btn-search-ticket").click()});$("#btn-search-ticket").off("click").on("click",function(){$("#pagination-ticket").twbsPagination("destroy");$("#ddlShowPage").prop("selectedIndex",0);common.config.pageIndex=1;ticket.loadData()});$("body").on("click",".btnUpdateTicket",function(){var n=$(this).attr("data-id");ticket.loadDetail(n)});$("#btn-save-ticket").on("click",function(){ticket.updateTicket()})},loadData:function(){var n="",t=$("#tbl-ticket-template").html();$.ajax({type:"GET",url:"/Admin/Ticket/GetAllPaging",data:{page:common.config.pageIndex,pageSize:common.config.pageSize,keyword:$("#txt-ticket-keyword").val()},beforeSend:common.runLoadingIndicator(),success:function(i){$.each(i.Results,function(i,r){var u={};u.Id=r.Id;u.BillId=r.BillId;u.Title=r.Title;u.Email=r.Email;u.CreatedDate=common.formatDateTime(r.CreatedDate);u.Status=common.getStatusTicket(r.Status);n+=Mustache.render(t,u)});$("#tbl-ticket-content").html(n);$("#lbl-total-ticket").html(i.RowCount);i.RowCount>0&&ticket.pagination(i.RowCount);common.stopLoadingIndicator()}})},loadDetail:function(n){$.ajax({type:"GET",url:"/Admin/Ticket/LoadDetail",data:{id:n},beforeSend:common.runLoadingIndicator(),success:function(t){$("#txt-bill-number").val(t.BillId);$("#txt-ticket-email").val(t.Email);$("#txt-ticket-title").val(t.Title);$("#txt-ticket-message").val(t.Content);$("#txt-ticket-date").val(common.formatDateTime(t.CreatedDate));$("#ckStatus").prop("checked",t.Status);$("#hid-ticket-id").val(n);$("#view-ticket-modal").modal("show");common.stopLoadingIndicator()}})},updateTicket:function(){var n={};n.id=$("#hid-ticket-id").val();n.BillId=$("#txt-bill-number").val();n.Email=$("#txt-ticket-email").val();n.Title=$("#txt-ticket-title").val();n.Content=$("#txt-ticket-message").val();n.CreatedDate=$("#txt-ticket-date").val();n.Status=$("#ckStatus").is(":checked")?1:0;$.ajax({type:"POST",url:"/Admin/Ticket/UpdateTicket",data:{ticket:n},beforeSend:common.runLoadingIndicator(),success:function(n){n==!0?(common.notify("Update ticket success","success"),$("#view-ticket-modal").modal("hide"),common.stopLoadingIndicator(),ticket.loadData()):common.notify("Update ticket failed","error")}})},pagination:function(n){var t=Math.ceil(n/common.config.pageSize);$("#pagination-ticket").twbsPagination({totalPages:t,visiblePages:5,onPageClick:function(n,t){t!=common.config.pageIndex&&(common.config.pageIndex=t,ticket.loadData())}})}};ticket.init();