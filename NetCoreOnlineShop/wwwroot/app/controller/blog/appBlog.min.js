var appBlog={init:function(){this.loadData();this.registerEvents();this.loadCkEditor()},registerEvents:function(){var n=$("#frm-blog").validate({errorClass:"red",rules:{txtBlogName:"required",txtBlogThumbnail:"required",txtBlogDescription:"required",txtBlogContent:"required",blogTag:"required"},messages:{txtBlogName:{required:"Name is required"},txtBlogThumbnail:{required:"Thumbnail is required"},txtBlogDescription:{required:"Description is required"},txtBlogContent:{required:"Content is required"},blogTag:{required:"Content is required"}},showErrors:function(t,i){if(n.submitted){var r="";$.each(i,function(){r+="* "+this.message+"\n"});common.notify(r,"warn");submitted=!1}}});$("#ddlShowPage").on("change",function(){common.config.pageSizeSmall=$("#ddlShowPage :selected").text();common.config.pageIndex=1;$("#pagination-blog").twbsPagination("destroy");appBlog.loadData()});$("#txt-blog-keyword").on("keypress",function(n){n.which===13&&$("#btn-search-blog").click()});$("#btn-search-blog").off("click").on("click",function(){$("#pagination-blog").twbsPagination("destroy");$("#ddlShowPage").prop("selectedIndex",0);common.config.pageIndex=1;common.config.pageSizeSmall=5;appBlog.loadData()});$("#ddl-blog-options").off("change").on("change",function(){common.config.pageSizeSmall=$("#ddlShowPage :selected").text();common.config.pageIndex=1;$("#pagination-blog").twbsPagination("destroy");appBlog.loadData()});$("#btn-create-blog").off("click").on("click",function(){$("#add-edit-blog").modal("show");n.resetForm();appBlog.clearForm()});$("body").on("click",".btnUpdateBlog",function(){var n=$(this).data("id");$("#hid-blog-id").val(n);$.ajax({type:"GET",url:"/Admin/Blog/GetBlogDetails",data:{id:n},beforeSend:common.runLoadingIndicator(),success:function(n){$("#add-edit-blog").modal("show");$("#txt-blog-name").val(n.Name);$("#txt-blog-thumbnail").val(n.Thumbnail);$("#txt-blog-description").val(n.Description);$("#txt-blog-view").val(n.ViewCount);$("#txt-blog-tag").val(n.Tags);CKEDITOR.instances["txt-blog-content"].setData(n.Content);$("#ck-blog-status").prop("checked",n.Status);$("#ck-blog-show-home").prop("checked",n.HomeFlag);$("#ck-blog-hot").prop("checked",n.HotFlag);$("#hid-blog-date").val(n.CreatedDate);common.stopLoadingIndicator()},error:function(n){common.notify("Error: "+n,"error");common.stopLoadingIndicator()}})});$("#btn-select-thumbnail").off("click").on("click",function(){$("#file-blog-thumbnail").val("");$("#file-blog-thumbnail").click()});$("#file-blog-thumbnail").on("change",function(){appBlog.thumbnail=$(this)[0].files[0];$("#txt-blog-thumbnail").val("/client-side/images/blog/"+appBlog.thumbnail.name)});$("#btn-save-blog").off("click").on("click",function(){var i=$("#hid-blog-id").val(),t;n.form()&&(t=new FormData,i!=""&&i!=undefined&&(t.append("Id",i),t.append("CreatedDate",$("#hid-blog-date").val())),t.append("image",appBlog.thumbnail),t.append("Name",$("#txt-blog-name").val()),t.append("Description",$("#txt-blog-description").val()),t.append("Thumbnail",$("#txt-blog-thumbnail").val()),t.append("Content",CKEDITOR.instances["txt-blog-content"].getData()),t.append("ViewCount",$("#txt-blog-view").val()),t.append("Tags",$("#txt-blog-tag").val()),t.append("Status",$("#ck-blog-status").is(":checked")?1:0),t.append("HomeFlag",$("#ck-blog-show-home").is(":checked")?1:0),t.append("HotFlag",$("#ck-blog-hot").is(":checked")?1:0),$.ajax({type:"POST",url:"/Admin/Blog/SaveBlog",data:t,processData:!1,contentType:!1,beforeSend:common.runLoadingIndicator(),success:function(){common.notify("Save blog success.","success");$("#add-edit-blog").modal("hide");appBlog.loadData();common.stopLoadingIndicator()},error:function(n){common.notify("Error: "+n,"error");common.stopLoadingIndicator()}}))});$("body").on("click",".btnBlogImage",function(){$("#tbl-gallery-content").html("");$("#blog-img-gallery").modal("show");var n=$(this).attr("data-id");$("#hid-blog-id").val(n);appBlog.galerry=[];$.ajax({type:"GET",url:"/Admin/Blog/GetGalleryImage",data:{id:n},beforeSend:common.runLoadingIndicator(),success:function(n){var t="",i=$("#tbl-gallery-template").html();$.each(n,function(n,r){var u={};u.Id=r.Id;u.Image=common.formatImageWithSize(r.Path,r.Caption,80);u.Size=(r.Size*1e-6).toFixed(2);t+=Mustache.render(i,u)});t!=""&&$("#tbl-gallery-content").html(t);$("#lbl-blog-total-image").text("Uploaded image: "+n.length);common.stopLoadingIndicator()},error:function(n){common.notify("Error: "+n,"error");common.stopLoadingIndicator()}})});$("#btn-import-imgs").off("click").on("click",function(){$("#file-blog-imgs-import").val("");$("#file-blog-imgs-import").click()});$("#file-blog-imgs-import").off("change").on("change",function(){var t=$(this)[0].files,n,i;appBlog.galerry=t;n="";i=$("#tbl-gallery-template").html();$.each(t,function(t,r){var f=window.URL||window.webkitURL,e=f.createObjectURL(r),u={};u.Image=common.formatImageWithSize(e,r.name,80);u.Size=(r.size*1e-6).toFixed(2);n+=Mustache.render(i,u)});n!=""&&$("#tbl-gallery-content").append(n)});$("body").on("click",".btn-remove-img",function(){var n=$(this).attr("data-id"),t=this;n!=""&&n!=undefined?common.confirm("Are you sure to remove?",function(){$.ajax({type:"POST",url:"/Admin/Blog/RemoveImage",data:{id:n},beforeSend:common.runLoadingIndicator(),success:function(){common.notify("Remove success!","success");$(t).closest("tr").remove();common.stopLoadingIndicator()},error:function(n){common.notify("Error: "+n,"error");common.stopLoadingIndicator()}})}):$(this).closest("tr").remove()});$("#btn-upload-imgs").off("click").on("click",function(){var t=$("#hid-blog-id").val(),n;appBlog.galerry.length!=0&&(n=new FormData,n.append("blogId",t),$.each(appBlog.galerry,function(t,i){n.append(i.name,i)}),$.ajax({type:"POST",url:"/Admin/Blog/UploadMultiImages",data:n,beforeSend:common.runLoadingIndicator(),processData:!1,contentType:!1,success:function(n){n.Success?common.notify(n.Message,"success"):common.notify(n.Message,"error");$("#blog-img-gallery").modal("hide");common.stopLoadingIndicator()},error:function(n){common.notify("Error: "+n,"error");common.stopLoadingIndicator()}}))});$("body").on("click",".btnDeleteBlog",function(){var n=$(this).attr("data-id");common.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Blog/RemoveBlog",data:{id:n},beforeSend:common.runLoadingIndicator(),success:function(){common.notify("Remove success!","success");appBlog.loadData();common.stopLoadingIndicator()},error:function(n){common.notify("Error: "+n,"error");common.stopLoadingIndicator()}})})})},thumbnail:[],galerry:[],loadData:function(){var n="",t=$("#tbl-blog-template").html();$.ajax({type:"GET",url:"/Admin/Blog/GetAllPaging",data:{page:common.config.pageIndex,pageSize:common.config.pageSizeSmall,keyword:$("#txt-blog-keyword").val(),option:$("#ddl-blog-options :selected").val()},beforeSend:common.runLoadingIndicator(),success:function(i){$.each(i.Results,function(i,r){var u={};u.Id=r.Id;u.Name=r.Name;u.Thumbnail=common.formatImageWithSize(r.Thumbnail,r.Name,120);u.Description=r.Description;u.CreatedDate=common.formatDateTime(r.CreatedDate);u.Status=common.getStatusLabel(r.Status);n+=Mustache.render(t,u)});$("#tbl-blog-content").html(n);$("#lbl-total-blog").text(i.RowCount);i.RowCount>0&&appBlog.pagination(i.RowCount);common.stopLoadingIndicator()},error:function(){common.notify("An error has occurred while loading data","error");common.stopLoadingIndicator()}})},pagination:function(n){var t=Math.ceil(n/common.config.pageSizeSmall);$("#pagination-blog").twbsPagination({totalPages:t,visiblePages:5,onPageClick:function(n,t){t!=common.config.pageIndex&&(common.config.pageIndex=t,appBlog.loadData())}})},loadCkEditor:function(){CKEDITOR.replace("txtBlogContent",{language:"en",width:"615px",height:"180px"});$.fn.modal.Constructor.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(n){this.$element[0]===n.target||this.$element.has(n.target).length||$(n.target).closest(".cke_dialog, .cke").length||this.$element.trigger("focus")},this))}},clearForm:function(){$("#txt-blog-name").val("");$("#txt-blog-thumbnail").val("");$("#txt-blog-view").val(0);$("#txt-blog-tag").val("");$("#txt-blog-description").val("");CKEDITOR.instances["txt-blog-content"].setData("");$("#ck-blog-status").prop("checked",!0);$("#ck-blog-show-home").prop("checked",!1);$("#ck-blog-hot").prop("checked",!1)}};appBlog.init();