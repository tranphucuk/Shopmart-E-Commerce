var appUser={init:function(){this.registerEvents();this.loadData()},registerEvents:function(){var n=$("#frmUser").validate({errorClass:"red",rules:{Username:"required",UserPassword:"required",ConfirmPassword:"required",UserPassword:{required:!0,minlength:6},ConfirmPassword:{required:!0,minlength:6,equalTo:"#txtPassword"},EmailAddress:{email:!0,required:!0},FullName:"required",PhoneNumber:{required:!0,number:!0},Balance:{required:!0,number:!0}},messages:{Username:"Username is required",UserPassword:{required:"Password is required",minlength:"Password must least 6 characters"},ConfirmPassword:{required:"Confirm password is required",equalTo:"Password is not matched"},EmailAddress:{required:"Email address is required",email:"Please enter an accurate email address"},FullName:{required:"Full name is required"},PhoneNumber:{required:"Phone number is required",number:"please enter correct phone number"}},showErrors:function(t,i){if(n.submitted){var r="";$.each(i,function(){r+="* "+this.message+"\n"});common.notify(r,"warn");submitted=!1}}});$("body").on("click",".btnUpdateUser",function(t){t.preventDefault();var i=$(this).attr("data-id");n.resetForm();$.ajax({type:"GET",url:"/Admin/User/GetUserByIdAsync",data:{id:i},dataType:"json",success:function(n){$("#add_edit_user").modal("show");appUser.commonConfig("update");$("#hidUserId").val(n.Id);$("#txtUsername").val(n.UserName);$("#txtEmailaddress").val(n.Email);$("#txtPhoneNumber").val(n.PhoneNumber);$("#txtFullName").val(n.FullName);$("#txtBalance").val(n.Balance);$("#txtAvatarImg").val(n.Avatar);$("#txtCreatedDate").val(common.formatDateTime(n.CreatedDate));$("#txtModifiedDate").val(common.formatDateTime(n.ModifiedDate));$("#ckStatus").prop("checked",n.Status);var t=$.ajax(appUser.initRoles());t.done(function(){$("#frmUser input[data-id]").each(function(t,i){n.Roles.indexOf($(i).attr("data-id"))!==-1&&(i.checked=!0)})});$(".hideBorder").val("Update User: "+n.UserName)}})});$("body").on("click","#btnCreate",function(){$("#add_edit_user").modal("show");$(".hideBorder").val("Create New User");appUser.clearForm();n.resetForm();appUser.initRoles();appUser.commonConfig("create")});$("#btnSave").off("click").on("click",function(t){var i,r;t.preventDefault();n=$("#frmUser").validate();n.form()&&(i={},$("#hidUserId").val()!=""&&(i.Id=$("#hidUserId").val(),i.CreatedDate=$("#txtCreatedDate").val()),r=[],i.UserName=$("#txtUsername").val(),i.Password=$("#txtPassword").val(),i.Email=$("#txtEmailaddress").val(),i.PhoneNumber=$("#txtPhoneNumber").val(),i.FullName=$("#txtFullName").val(),i.Balance=$("#txtBalance").val(),i.Avatar=$("#txtAvatarImg").val(),i.Status=$("#ckStatus").is(":checked")?1:0,$("#frmUser input[data-id]").each(function(n,t){$(t).is(":checked")&&r.push($(t).attr("data-id"))}),i.Roles=r,$.ajax({type:"POST",url:"/Admin/User/AccountAsync",data:{appUserVm:i},success:function(n){appUser.loadData();$("#add_edit_user").modal("hide");n.HttpType=="update"?common.notify('Update user: "'+n.ObjReturn+'" succeeded.',"success"):common.notify('Create user: "'+n.ObjReturn+'" succeeded.',"success")},error:function(n){$("#add_edit_user").modal("hide");appUser.loadData();common.notify(n.responseText,"error");console.log(n)}}))});$("body").on("click",".btnDeleteUser",function(n){n.preventDefault();var t=$(this).attr("data-id");common.confirm("Are you sure to delete ?",function(){$.ajax({type:"POST",url:"/Admin/User/DeleteAsync",data:{id:t},dataType:"json",success:function(n){common.notify("Removed user: "+n.Message,"success");appUser.loadData()},error:function(n){common.notify("An error has occurred while removing: "+n.Message,"error");appUser.loadData()}})})});$("#ddlShowPage").on("change",function(){common.config.pageSize=$("#ddlShowPage :selected").text();common.config.pageIndex=1;$("#pagination-user").twbsPagination("destroy");appUser.loadData()});$("#txtKeyword").off("keypress").on("keypress",function(n){n.which==13&&$("#btnSearch").click()});$("#btnSearch").off("click").on("click",function(){$("#pagination-user").twbsPagination("destroy");appUser.loadData()});$("#btnSelectImg").off("click").on("click",function(){$("#fileUserAvatar").click()});$("#fileUserAvatar").off("change").on("change",function(){var n={FileSize:this.files[0].size,FileName:this.files[0].name};common.readImg(this.files[0],function(t){n.ImgValueBase64=t.target.result;$.ajax({type:"POST",url:"/Admin/Upload/UploadImage",data:{imageVm:n},success:function(n){$("#txtAvatarImg").val(n.ImgPath);common.notify('Saved an image name: "  '+n.FileName+'  " to root folder',"success")},error:function(n){common.notify("An error has occurred, please check console","error");console.log(n)}})})})},commonConfig:function(n){n=="update"?($("#txtUsername").prop("disabled",!0),$("#txtPassword").prop("disabled",!0),$("#txtConfirmPassword").prop("disabled",!0),$("#frmConfirmPassword,#frmPassword").hide(),$("#frmCreatedDate,#frmModifiedDate").show()):n=="create"&&($("#frmConfirmPassword,#frmPassword").show(),$("#txtUsername").prop("disabled",!1),$("#txtPassword").prop("disabled",!1),$("#txtConfirmPassword").prop("disabled",!1),$("#txtUsername").prop("disabled",!1),$("#frmCreatedDate,#frmModifiedDate").hide())},loadData:function(){var t=$("#table-template").html(),n="";$.ajax({type:"GET",url:"/Admin/User/GetAllPaging",dataType:"json",data:{keyword:$("#txtKeyword").val(),pageSize:common.config.pageSize,page:common.config.pageIndex},success:function(i){$.each(i.Results,function(i,r){var u={Id:r.Id,Username:r.UserName,Fullname:r.FullName,Avatar:common.formatImage(r.Avatar),EmailAddress:r.Email,PhoneNumber:r.PhoneNumber,Balance:common.formartNumber(r.Balance),CreatedDate:common.formatDate(r.CreatedDate),Status:common.getStatusLabel(r.Status)};n+=Mustache.render(t,u)});$("#tbl-content").html(n);$("#lblTotalRecords").text(i.RowCount);i.RowCount>0&&appUser.pagination(i.RowCount)},error:function(n){console.log(n);common.notify("An error has occurred","error")}})},initRoles:function(){$.ajax({type:"GET",url:"/Admin/Role/GetAllAsync",success:function(n){var t="",i=$("#role-checkbox-template").html();$.each(n,function(n,r){var u={};u.Name=r.Name;u.Description=r.Description;t+=Mustache.render(i,u)});t!=""&&$("#render-checkbox").html(t)},error:function(n){console.log(n);common.notify("Error loading data","error")}})},clearForm:function(){$("#hidUserId").val("");$("#txtUsername").val("");$("#txtPassword").val("");$("#txtConfirmPassword").val("");$("#txtEmailaddress").val("");$("#txtPhoneNumber").val("");$("#txtFullName").val("");$("#txtBalance").val(0);$("#txtAvatarImg").val("");$("#ckStatus").prop("checked",!0)},pagination:function(n){var t=Math.ceil(n/common.config.pageSize);$("#pagination-user").twbsPagination({totalPages:t,visiblePages:5,onPageClick:function(n,t){t!=common.config.pageIndex&&(common.config.pageIndex=t,appUser.loadData())}})}};appUser.init();