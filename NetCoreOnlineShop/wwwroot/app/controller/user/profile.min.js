var profile={init:function(){this.loadData();this.registerEvents()},registerEvents:function(){var n=$("#frm-profile").validate({errorClass:"red",rules:{txFullname:"required",txtUserAvatar:"required",Address:"required",PhoneNumber:"required",oldPassword:{required:!0},NewPassword:{minlength:6,maxlength:20}},messages:{txFullname:{required:"Username is required"},txtUserAvatar:{required:"Avatar is required"},Address:{required:"Address is required"},PhoneNumber:{required:"Phone number is required"},oldPassword:{required:"Please enter your current password"},NewPassword:{minLenghth:"minimum length of 8 characters",maxLength:"maximum length of 20 characters"}},showErrors:function(t,i){if(n.submitted){var r="";$.each(i,function(){r+="* "+this.message+"\n"});common.notify(r,"warn");submitted=!1}}});$("#btn-edit").on("click",function(){$("#txt-user-oldpass").val("");$("#txt-user-newpass").val("");profile.loadUserDetail()});$("#btn-select-avatar").off("click").on("click",function(){$("#file-user-avatar").val("");$("#file-user-avatar").click()});$("#file-user-avatar").on("change",function(){profile.avatar=$(this)[0].files[0];$("#txt-user-avatar").val("/images/avatar/"+profile.avatar.name)});$("#btn-save-profile").on("click",function(){if(n.form()){var t=new FormData;profile.avatar!=undefined&&profile.avatar!=""&&t.append("Avatar",profile.avatar);t.append("FullName",$("#txt-fullname").val());t.append("Address",$("#txt-user-address").val());t.append("Avatar",$("#txt-user-avatar").val());t.append("PhoneNumber",$("#txt-user-phone").val());t.append("OldPassword",$("#txt-user-oldpass").val());t.append("NewPassword",$("#txt-user-newpass").val());$.ajax({type:"POST",url:"/Admin/Account/UpdateProfile",data:t,processData:!1,contentType:!1,beforeSend:common.runLoadingIndicator(),success:function(n){n.Success==!1?(common.notify(n.Message,"success"),$("#edit-profile").modal("hide"),profile.loadData(),common.stopLoadingIndicator()):(common.notify(n.Message,"error"),common.stopLoadingIndicator())}})}})},avatar:[],loadData:function(){var n="",t=$("#tbl-activity-template").html();$.ajax({type:"GET",url:"/Admin/Account/LoadData",data:{page:common.config.pageIndex,pageSize:common.config.pageSize},beforeSend:common.runLoadingIndicator(),success:function(i){$("#user-avatar").attr("src",i.User.Avatar);$("#user-avatar").attr("alt",i.User.FullName);$("#user-avatar").attr("title",i.User.FullName);$("#user-name").html(" "+i.User.FullName);$("#user-location").html(" "+i.User.Address);$("#user-role").html(" "+i.User.Roles[0]);$("#user-email").html(" "+i.User.Email);$("#user-date").html(" "+common.formatDate(i.User.CreatedDate));$("#user-phone").html(" "+i.User.PhoneNumber);$.each(i.Activities.Results,function(i,r){var u={};u.Username=r.Username;u.LastSession=common.formatDateTime(r.LastSession);u.Device=r.Device;u.IpAddress=r.IPAddress;n+=Mustache.render(t,u)});$("#tbl-activity-content").html(n);$("#lbl-total-activity").html(i.Activities.RowCount);i.Activities.RowCount>0&&profile.paginationActivity(i.Activities.RowCount);common.stopLoadingIndicator()}})},loadUserDetail:function(){$.ajax({type:"GET",url:"/Admin/Account/GetUserDetail",beforeSend:common.runLoadingIndicator(),success:function(n){$("#txt-fullname").val(n.FullName);$("#txt-user-address").val(n.Address);$("#txt-user-avatar").val(n.Avatar);$("#txt-user-phone").val(n.PhoneNumber);$("#edit-profile").modal("show");common.stopLoadingIndicator()}})},paginationActivity:function(n){var t=Math.ceil(n/common.config.pageSize);$("#pagination-activity").twbsPagination({totalPages:t,visiblePages:5,onPageClick:function(n,t){t!=common.config.pageIndex&&(common.config.pageIndex=t,profile.loadData())}})}};profile.init();