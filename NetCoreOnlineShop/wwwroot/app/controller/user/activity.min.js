var activity={init:function(){$.when(activity.loadRoleToDropDown()).then(function(){activity.loadDataUser();activity.registerEvents()})},registerEvents:function(){$("#ddl-role").on("change",function(){var n=$("#ddl-role :selected").text();common.config.pageIndex=1;$("#pagination-users-table").twbsPagination("destroy");$("#pagination-activity").twbsPagination("destroy");activity.loadDataUser(n)});$("body").on("click",".btn-view-activity",function(){var n=$(this).attr("data-id");$("#hid-user-id").val(n);$("#pagination-activity").twbsPagination("destroy");activity.loadActivities(n)});$("#txt-search").on("keypress",function(n){n.which===13&&($("#pagination-users-table").twbsPagination("destroy"),$("#pagination-activity").twbsPagination("destroy"),activity.loadDataUser())})},loadRoleToDropDown:function(){var n="";return $.ajax({type:"GET",url:"/Admin/Role/GetAllAsync",success:function(t){$.each(t,function(t,i){n+=t==0?'<option value="'+i.Name+'" selected="selected">'+i.Name+"<\/option>":'<option value="'+i.Name+'">'+i.Name+"<\/option>"});$("#ddl-role").html(n)}})},loadDataUser:function(n){n=n||$("#ddl-role :selected").text();var t="",i=$("#tbl-load-user-template").html();$.ajax({type:"GET",url:"/Admin/Activity/GetUsersByRole",data:{roleName:n,page:common.config.pageIndex,pageSize:common.config.pageSize,keyword:$("#txt-search").val()},dataType:"json",success:function(n){$.each(n.Results,function(n,r){var u={};u.Id=r.Id;u.Username=r.UserName;u.CreatedDate=common.formatDate(r.CreatedDate);t+=Mustache.render(i,u)});$("#tbl-users-content").html(t);activity.paginationUser(n.RowCount);var r=$("#tbl-users-content tr:first").attr("data-id");r!=undefined&&r!=""&&($("#hid-user-id").val(r),activity.loadActivities(r))}})},loadActivities:function(n){n=n||$("#hid-user-id").val();var t="",i=$("#tbl-activity-template").html();$.ajax({type:"GET",url:"/Admin/Activity/GetActivityById",data:{userId:n,page:common.config.pageIndex,pageSize:common.config.pageSize},beforeSend:common.runLoadingIndicator(),dataType:"json",success:function(n){$.each(n.Results,function(n,r){var u={};u.Username=r.Username;u.LastSession=common.formatDateTime(r.LastSession);u.Device=r.Device;u.IpAddress=r.IPAddress;t+=Mustache.render(i,u)});$("#tbl-activity-content").html(t);$("#lbl-total-activity").html(n.RowCount);n.RowCount>0&&activity.paginationActivity(n.RowCount);common.stopLoadingIndicator()}})},paginationUser:function(n){var t=Math.ceil(n/common.config.pageSize);$("#pagination-users-table").twbsPagination({totalPages:t,visiblePages:3,onPageClick:function(n,t){if(t!=common.config.pageIndex){common.config.pageIndex=t;var i=i||$("#ddl-role :selected").text();$("#pagination-activity").twbsPagination("destroy");activity.loadDataUser(i)}}})},paginationActivity:function(n){var t=Math.ceil(n/common.config.pageSize);$("#pagination-activity").twbsPagination({totalPages:t,visiblePages:5,onPageClick:function(n,t){t!=common.config.pageIndex&&(common.config.pageIndex=t,activity.loadActivities())}})}};activity.init();