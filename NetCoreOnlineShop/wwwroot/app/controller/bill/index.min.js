var bill={init:function(){$.when(bill.loadProduct(),bill.loadPaymentMethod(),bill.loadBillStatus(),bill.loadColor(),bill.loadSize()).then(function(){bill.loadData();bill.registerEvents()})},registerEvents:function(){var n=$("#frmBill").validate({errorClass:"red",rules:{customerName:"required",customerAddress:"required",customerPhone:{required:!0,number:!0},customerEmail:{required:!0,email:!0},paymentMethod:"required",billStatus:"required",customerMessage:"required"},messages:{customerName:{required:"Customer name is required"},customerAddress:{required:"Customer address is required"},customerPhone:{required:"Customer phone is required",number:"Please enter correct phone number"},paymentMethod:{required:"Payment method is required"},billStatus:{required:"Payment method is required"},customerMessage:{required:"Customer message is required"},customerEmail:{required:"Email address is required",email:"Please provide an accurate email address"}},showErrors:function(t,i){if(n.submitted){var r="";$.each(i,function(){r+="* "+this.message+"\n"});common.notify(r,"warn");submitted=!1}}});$('input[name="date-range"]').daterangepicker({opens:"left",autoUpdateInput:!1,locale:{cancelLabel:"Clear"},ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Last 6 Months":[moment().subtract(180,"day"),moment().subtract(1,"day")]}},function(n,t){$('input[name="date-range"]').val(n.format("M/D/YYYY")+"-"+t.format("M/D/YYYY"));bill.configPagination()});$('input[name="date-range"]').on("cancel.daterangepicker",function(){$(this).val("");bill.configPagination()});$("#btnSearch").off("click").on("click",function(){bill.configPagination()});$("#txtKeyword").on("keypress",function(n){n.which===13&&bill.configPagination()});$("#btnCreate").on("click",function(){$("#add_edit_bill_detail_modal").modal("show");bill.commonConfig();bill.clearForm()});$("#btnAddDetail").on("click",function(){var t=$("#template-table-bill-details").html(),n="";common.runLoadingIndicator();$.when(bill.loadProductToDropDown(),bill.loadSizeToDropDown(),bill.loadColorToDropDown()).then(function(){n=Mustache.render(t,{ProductName:bill.productDropDownData,Color:bill.colorDropDownData,Size:bill.sizeDropDownData,Quantity:0})});n!=""&&($("#tbl-bill-details").append(n),bill.dropdownConfig(),common.stopLoadingIndicator())});$("#tbl-bill-details").on("click",".btn-delete-detail",function(){$(this).closest("tr").remove()});$("#btnSave").on("click",function(){var i=$("#hidBill").val(),t;n.form()&&(t={},i!=undefined&&i!=""&&(t.Id=i,t.CreatedDate=$("#txtCreatedDate").val()),t.CustomerName=$("#txtName").val(),t.CustomerAddress=$("#txtAddress").val(),t.CustomerPhone=$("#txtPhoneNumber").val(),t.CustomerMessage=$("#txtMessage").val(),t.CustomerEmail=$("#txtEmail").val(),t.PaymentMethod=$("#ddlPaymentMethod").val(),t.BillStatus=$("#ddlBillStatus").val(),t.Status=$("#ckStatus").is(":checked")?1:0,t.billDetails=[],$("#tbl-bill").find("tbody tr").each(function(n,i){var r={};$(i).attr("data-id")!=""&&$(i).attr("data-id")!=undefined&&(r.Id=$(i).attr("data-id"),r.BillId=t.Id);r.ProductId=$(i).find(".ddlProducts option:selected").val();r.Quantity=$(i).find("#txtQuantity").val();r.ColorId=$(i).find(".ddlColor option:selected").val();r.SizeId=$(i).find(".ddlSize option:selected").val();t.billDetails.push(r)}),$.ajax({type:"POST",url:"/Admin/Bill/SaveBill",data:{billViewModel:t},beforeSend:common.runLoadingIndicator(),success:function(n){n.Message=="create"?common.notify("Create bill succeeded","success"):common.notify("Update bill: "+n.Data.CustomerName+" succeeded","success");bill.loadData();common.stopLoadingIndicator();$("#add_edit_bill_detail_modal").modal("hide")},error:function(n){console.log(n);common.notify("Error: "+n,"error");common.stopLoadingIndicator()}}))});$("body").on("click",".btnUpdateBill",function(){var n=$(this).attr("data-id");$.ajax({type:"GET",url:"/Admin/Bill/GetBillDetail",data:{id:n},beforeSend:common.runLoadingIndicator(),success:function(t){$("#hidBill").val(t.Id);$("#add_edit_bill_detail_modal").modal("show");bill.commonConfig(n);$("#txtName").val(t.CustomerName);$("#txtAddress").val(t.CustomerAddress);$("#txtPhoneNumber").val(t.CustomerPhone);$("#txtMessage").val(t.CustomerMessage);$("#txtEmail").val(t.CustomerEmail);$("#ddlPaymentMethod").val(t.PaymentMethod);$("#ddlBillStatus").val(t.BillStatus);$("#txtCreatedDate").val(common.formatDateTime(t.CreatedDate));$("#txtModifiedDate").val(common.formatDateTime(t.ModifiedDate));$("#ckStatus").prop("checked",t.Status);var i="",r=$("#template-table-bill-details").html();$.each(t.BillDetails,function(n,t){$.when(bill.loadColorToDropDown(t.ColorId),bill.loadProductToDropDown(t.ProductId),bill.loadSizeToDropDown(t.SizeId)).then(function(){i+=Mustache.render(r,{Id:t.Id,ProductName:bill.productDropDownData,Color:bill.colorDropDownData,Size:bill.sizeDropDownData,Quantity:t.Quantity})})});$("#tbl-bill-details").html(i);bill.dropdownConfig();common.stopLoadingIndicator()},error:function(n){console.log(n);common.notify("Error: "+n,"error");common.stopLoadingIndicator()}})});$("body").on("click",".btnDeleteBill",function(){var n=$(this).attr("data-id");common.confirm("Are you sure to delete?",function(){$.ajax({type:"POST",url:"/Admin/Bill/DeleteBill",data:{id:n},success:function(n){bill.loadData();common.notify("Removed: "+n.Data.CustomerName,"success")},error:function(n){console.log(n);common.notify("Error: "+n,"error")}})})});$("#btnExportExcel").off("click").on("click",function(){var n=$("#hidBill").val();$.ajax({type:"POST",url:"/Admin/Bill/ExportBill",data:{billId:n},beforeSend:common.runLoadingIndicator(),success:function(n){window.location.href=n;common.stopLoadingIndicator()},error:function(n){console.log(n);common.notify("Error: "+n,"error")}})});$("#ddl-bill-status").on("change",function(){bill.configPagination()});$("#ddlShowPage").on("change",function(){common.config.pageSize=$("#ddlShowPage :selected").text();common.config.pageIndex=1;$("#pagination-bill").twbsPagination("destroy");bill.loadData()})},productData:[],productDropDownData:[],colorData:[],colorDropDownData:[],sizeData:[],sizeDropDownData:[],commonConfig:function(n){$(".hideBorder").val("Add/Edit Bill Detail");n==null?($("#frmModifiedDate").hide(),$("#frmCreatedDate").hide()):($("#frmModifiedDate").show(),$("#frmCreatedDate").show())},configPagination:function(){common.config.pageSize=$("#ddlShowPage :selected").text();common.config.pageIndex=1;$("#pagination-bill").twbsPagination("destroy");bill.loadData()},clearForm:function(){$("#txtName").val("");$("#txtAddress").val("");$("#txtPhoneNumber").val("");$("#txtMessage").val("");$("#txtEmail").val("");$("#ddlPaymentMethod").val(0);$("#ddlBillStatus").val(0);$("#tbl-bill-details").empty()},dropdownConfig:function(){$(".ddlProducts").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"95%"});$(".ddlSize").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"95%"});$(".ddlColor").chosen({disable_search_threshold:10,no_results_text:"Oops, nothing found!",width:"95%"})},loadSize:function(){return $.ajax({type:"GET",url:"/Admin/Bill/GetAllSize",success:function(n){bill.sizeData=n},error:function(n){console.log(n);common.notify("Error: "+n,"error")}})},loadSizeToDropDown:function(n){var t='<select class="form-control ddlSize">';$.each(bill.sizeData,function(i,r){t+=n==r.Id?'<option value="'+r.Id+'" selected="selected">'+r.Name+"<\/option>":'<option value="'+r.Id+'">'+r.Name+"<\/option>"});bill.sizeDropDownData=t+"<\/select>"},loadColor:function(){return $.ajax({type:"GET",url:"/Admin/Bill/GetAllColor",success:function(n){bill.colorData=n},error:function(n){console.log(n);common.notify("Error: "+n,"error")}})},loadColorToDropDown:function(n){var t='<select class="form-control ddlColor">';$.each(bill.colorData,function(i,r){t+=r.Id==n?'<option value="'+r.Id+'" selected="selected">'+r.Name+"<\/option>":'<option value="'+r.Id+'">'+r.Name+"<\/option>"});bill.colorDropDownData=t+"<\/select>"},loadProduct:function(){return $.ajax({type:"GET",url:"/Admin/Product/GetAllForBill",beforeSend:common.runLoadingIndicator(),success:function(n){bill.productData=n;common.stopLoadingIndicator()},error:function(n){console.log(n);common.notify("Error: "+n,"error");common.stopLoadingIndicator()}})},loadProductToDropDown:function(n){var t='<select class="form-control ddlProducts">';$.each(bill.productData,function(i,r){t+=r.Id==n?'<option value="'+r.Id+'" selected="selected">'+r.Name+"<\/option>":'<option value="'+r.Id+'">'+r.Name+"<\/option>"});bill.productDropDownData=t+"<\/select>"},loadData:function(){var n="",t=$("#table-template").html();$.ajax({type:"GET",url:"/Admin/Bill/GetAllBillPaging",data:{pageSize:common.config.pageSize,page:common.config.pageIndex,option:$("#ddl-bill-status").val(),fromDate:$("#txt-date-range").val().split("-")[0],toDate:$("#txt-date-range").val().split("-")[1],keyword:$("#txtKeyword").val()},beforeSend:common.runLoadingIndicator(),success:function(i){$.each(i.Results,function(i,r){var u={};u.Id=r.Id;u.CustomerName=r.CustomerName;u.PaymentMethod=common.definePaymentMethod(r.PaymentMethod);u.BillStatus=common.definePaymentStatus(r.BillStatus);u.OrderDate=common.formatDateTime(r.CreatedDate);u.Status=common.getStatusLabel(r.Status);u.Id=r.Id;n+=Mustache.render(t,u);n!=null&&n!=""&&$("#tbl-content").html(n)});n==""&&$("#tbl-content").empty();i.RowCount>0&&bill.pagination(i.RowCount);$("#lblTotalRecords").html(i.RowCount);common.stopLoadingIndicator()},error:function(n){console.log(n);common.notify("Error: "+n,"error");common.stopLoadingIndicator()}})},loadPaymentMethod:function(){$.ajax({type:"GET",url:"/Admin/Bill/GetPaymentMethod",success:function(n){var t=[];$.each(n,function(n,i){t.push('<option value="'+i.Value+'">'+i.Name+"<\/option>")});$("#ddlPaymentMethod").html(t)},error:function(n){console.log(n);common.notify("Error: "+n,"error")}})},loadBillStatus:function(){$.ajax({type:"GET",url:"/Admin/Bill/GetBillStatus",success:function(n){var t=[];$.each(n,function(n,i){t.push('<option value="'+i.Value+'">'+i.Name+"<\/option>")});$("#ddlBillStatus").html(t)},error:function(n){console.log(n);common.notify("Error: "+n,"error")}})},pagination:function(n){var t=Math.ceil(n/common.config.pageSize);$("#pagination-bill").twbsPagination({totalPages:t,visiblePages:5,onPageClick:function(n,t){t!=common.config.pageIndex&&(common.config.pageIndex=t,bill.loadData())}})}};bill.init();